<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Klangunterstützung für Urinkontrollen</title>

  <!-- Comic Neue Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Comic+Neue:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap"
    rel="stylesheet">

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: #f4d1ae;
      /* warmes Gelb */
      color: #06bcc1;
      font-family: "Comic Neue", cursive;
      font-weight: 400;
      font-style: normal;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      padding: 40px 20px;
    }

    .screen-frame {
      border: 6px ridge #c0c0c0;
      background: #f4edea;
      max-width: 820px;
      width: 100%;
      box-shadow:
        0 0 0 3px #404040,
        6px 6px 0 #808080;
    }

    .title-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: linear-gradient(90deg, #023e8a, #0077b6);
      padding: 4px 8px;
      color: #ffffff;
      font-size: 0.9rem;
      font-family: "Comic Neue", cursive;
      font-weight: 700;
    }

    .title-bar-left {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .content {
      padding: 20px;
      border-top: 4px solid #d0d0d0;
    }

    h1 {
      font-size: 2.6rem;
      margin-bottom: 12px;
      text-align: center;
      color: #12263a;
      font-family: "Comic Neue", cursive;
      font-weight: 700;
    }

    .subtitle {
      text-align: center;
      font-size: 1.05rem;
      margin-bottom: 24px;
      color: #12263a;
      font-family: "Comic Neue", cursive;
      font-weight: 400;
      line-height: 1.5;
    }

    .buttons {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      grid-auto-rows: auto;
      gap: 18px;
      width: 100%;
      justify-items: center;
    }

    .img-btn {
      border: none;
      background: transparent;
      padding: 0;
      cursor: pointer;
      outline: none;
      position: relative;
    }

    /* Bild-Buttons */
    .img-btn img {
      width: 100%;
      max-width: 120px;
      aspect-ratio: 1 / 1;
      object-fit: contain;
      display: block;
      transition:
        transform 0.16s ease-out,
        filter 0.16s ease-out;
      filter: drop-shadow(0 2px 0 rgba(0, 0, 0, 0.25));
    }

    /* Hover/Focus: größer + heller */
    .img-btn:hover img,
    .img-btn:focus-visible img {
      transform: scale(1.08);
      filter: brightness(1.05);
    }

    .img-btn:active img {
      transform: scale(1.03);
      filter: brightness(1.02);
    }

    .status-bar {
      margin-top: 20px;
      padding: 6px 8px;
      border-top: 1px solid #12263a;
      font-size: 0.75rem;
      display: flex;
      justify-content: space-between;
      color: #12263a;
      font-family: "Comic Neue", cursive;
      font-weight: 400;
    }

    .status-bar span {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    @media (max-width: 700px) {
      .buttons {
        grid-template-columns: repeat(3, 1fr);
        gap: 14px;
      }

      .img-btn img {
        max-width: 90px;
      }

      h1 {
        font-size: 2.1rem;
      }

      .status-bar {
        flex-direction: column;
        gap: 4px;
      }
    }

    #audio-fallbacks {
      display: none;
    }
  </style>
</head>

<body>
  <div class="screen-frame">
    <div class="title-bar">
      <div class="title-bar-left">
        <span>pisshilfe.exe</span>
      </div>
      <!-- Close-Button entfernt -->
    </div>

    <div class="content">
      <h1>Klangunterstützung für Urinkontrollen</h1>

      <p class="subtitle">
        Diese Klangoberfläche wurde geschaffen, um Menschen während der Urinkontrolle
        zu unterstützen. Viele Betroffene erleben in dieser Situation Scham, Druck oder Blockaden beim Wasserlassen –
        insbesondere, wenn jemand anwesend ist und zuschaut. Die hier angebotenen Klänge können helfen, innere
        Anspannung zu reduzieren, den Fokus sanft nach innen zu lenken und das Wasserlassen unter Beobachtung zu
        erleichtern. Wähle in deinem Tempo einen Klang aus, der sich für dich stimmig anfühlt, und gib dir bewusst die
        Erlaubnis, in diesem Moment ganz bei dir anzukommen.
      </p>

      <div class="buttons" id="buttons"></div>

      <div class="status-bar">
        <span>VERSION 1.0</span>
        <span>© 1995 PISSHILFE MULTIMEDIA LABS</span>
      </div>
    </div>
  </div>

  <div id="audio-fallbacks">
    <audio id="audio1" src="sounds/sound1.m4a"></audio>
    <audio id="audio2" src="sounds/sound2.m4a"></audio>
    <audio id="audio3" src="sounds/sound3.m4a"></audio>
    <audio id="audio4" src="sounds/sound4.m4a"></audio>
    <audio id="audio5" src="sounds/sound5.m4a"></audio>
    <audio id="audio6" src="sounds/sound6.m4a"></audio>
    <audio id="audio7" src="sounds/sound7.m4a"></audio>
    <audio id="audio8" src="sounds/sound8.m4a"></audio>
    <audio id="audio9" src="sounds/sound9.m4a"></audio>
    <audio id="audio10" src="sounds/sound10.m4a"></audio>
    <audio id="audio11" src="sounds/sound11.m4a"></audio>
    <audio id="audio12" src="sounds/sound12.m4a"></audio>
  </div>

  <script>
    // Utility: Shuffle (Fisher–Yates)
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    let current = { source: null, gainNode: null };
    const buffers = {};
    const NUM_SOUNDS = 12;

    // Sounds laden
    async function loadSound(i) {
      try {
        const res = await fetch(`sounds/sound${i}.m4a`);
        const ab = await res.arrayBuffer();
        buffers[i] = await audioCtx.decodeAudioData(ab);
      } catch {
        buffers[i] = null;
      }
    }
    for (let i = 1; i <= NUM_SOUNDS; i++) loadSound(i);

    function crossfadeTo(buffer) {
      const now = audioCtx.currentTime;
      const newSource = audioCtx.createBufferSource();
      const newGain = audioCtx.createGain();

      newSource.buffer = buffer;
      newGain.gain.setValueAtTime(0, now);

      newSource.connect(newGain).connect(audioCtx.destination);
      newSource.start(now);
      newGain.gain.linearRampToValueAtTime(1, now + 1);

      if (current.source && current.gainNode) {
        const oldGain = current.gainNode;
        oldGain.gain.setValueAtTime(oldGain.gain.value, now);
        oldGain.gain.linearRampToValueAtTime(0, now + 1);
        current.source.stop(now + 1);
      }

      current = { source: newSource, gainNode: newGain };
    }

    function stopAllFallback() {
      for (let j = 1; j <= NUM_SOUNDS; j++) {
        const a = document.getElementById(`audio${j}`);
        if (a && !a.paused) {
          a.pause();
          a.currentTime = 0;
        }
      }
    }

    function playFallback(i) {
      stopAllFallback();
      const audioEl = document.getElementById(`audio${i}`);
      if (audioEl) audioEl.play();
    }

    // Bilddaten – Dateinamen bleiben gleich
    const imageData = Array.from({ length: NUM_SOUNDS }, (_, i) => ({
      src: `images/piss${i + 1}.png`,
      alt: `piss ${i + 1}`
    }));

    // Bilder & Sounds zufällig anordnen
    const imageIndices = shuffleArray(Array.from({ length: NUM_SOUNDS }, (_, i) => i));   // 0–11, Bilder
    const soundIds = shuffleArray(Array.from({ length: NUM_SOUNDS }, (_, i) => i + 1));   // 1–12, Sounds

    const btnContainer = document.getElementById('buttons');

    // Buttons + Bilder bauen
    for (let i = 0; i < NUM_SOUNDS; i++) {
      const wrapper = document.createElement('button');
      wrapper.className = 'img-btn';

      const img = document.createElement('img');
      const imgIndex = imageIndices[i];
      const data = imageData[imgIndex];

      img.src = data.src;
      img.alt = data.alt;

      const soundId = soundIds[i];

      wrapper.appendChild(img);
      btnContainer.appendChild(wrapper);

      wrapper.addEventListener('click', () => {
        const buffer = buffers[soundId];
        if (buffer) {
          crossfadeTo(buffer);
          if (audioCtx.state === 'suspended') audioCtx.resume();
        } else {
          playFallback(soundId);
        }
      });
    }

    // Mobile: AudioContext aktivieren
    document.body.addEventListener('touchstart', () => {
      if (audioCtx.state === 'suspended') {
        audioCtx.resume();
      }
    }, { once: true });
  </script>
</body>

</html>
